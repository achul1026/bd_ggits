<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN' 'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>

<mapper namespace='com.neighbor21.ggits.common.mapper.MGmStdLinkNodeMngInfoMapper'>

	<insert id="saveMGmStdLinkNodeMngInfo" parameterType="mGmStdLinkNodeMngInfo">
		INSERT INTO M_GM_STD_LINK_NODE_MNG_INFO (
			STD_INFO_ID,
			STD_INFO_NM,
			APLCN_YMD,
			SAVE_INFO,
			STD_APLCN_TYPE,
			RMRK
		) VALUES (
			#{stdInfoId},
			#{stdInfoNm},
			#{aplcnYmd},
			#{saveInfo},
			#{stdAplcnType},
			#{rmrk}
		)
	</insert>
	
	<select id="countByStdInfoNm" parameterType="mGmStdLinkNodeMngInfo" resultType="int">
		SELECT COUNT(1)
		FROM M_GM_STD_LINK_NODE_MNG_INFO
		WHERE 1=1
		<if test="searchType != null and searchType != '' ">
			and STD_APLCN_TYPE = #{searchType}
		</if>
		<if test="stdInfoNm != null and stdInfoNm != ''">
			AND STD_INFO_NM LIKE CONCAT('%', #{stdInfoNm}, '%')
		</if>
		<if test="searchContent != null and searchContent != ''">
			AND STD_INFO_NM LIKE CONCAT('%', #{searchContent}, '%')
		</if>
		<if test="aplcnYmd != null and aplcnYmd != '' ">
			AND TO_CHAR(TO_DATE(APLCN_YMD ,'YYYYMMDD'),'YYYY') = #{aplcnYmd}
		</if>
	</select>
	
	<select id="findByNodeLinkMngInfoByStdInfoNm" resultType="mGmStdLinkNodeMngInfo" parameterType="mGmStdLinkNodeMngInfo">
		SELECT
			ROW_NUMBER() OVER(ORDER BY APLCN_YMD) 	AS rownum,
			STD_INFO_ID,
			STD_INFO_NM,
			APLCN_YMD,
			SAVE_INFO,
			STD_APLCN_TYPE,
			RMRK
		FROM
			M_GM_STD_LINK_NODE_MNG_INFO
		WHERE 1=1
		<if test="searchType != null and searchType != '' ">
		  	and STD_APLCN_TYPE = #{searchType}
		</if>
		<if test="stdInfoNm != null and stdInfoNm != ''">
			AND STD_INFO_NM LIKE CONCAT('%', #{stdInfoNm}, '%')
		</if>
		<if test="searchContent != null and searchContent != ''">
			AND STD_INFO_NM LIKE CONCAT('%', #{searchContent}, '%')
		</if>
		<if test="aplcnYmd != null and aplcnYmd != '' ">
			AND TO_CHAR(TO_DATE(APLCN_YMD ,'YYYYMMDD'),'YYYY') = #{aplcnYmd}
		</if>
		ORDER BY
			<if test="searchType != null and searchType != '' ">
				<if test="searchType == 'LINK' ">
					STD_APLCN_TYPE ASC,
				</if> 
				<if test="searchType == 'NODE' ">
					STD_APLCN_TYPE DESC,
				</if> 
			</if>
				rownum DESC
		LIMIT 10 OFFSET (#{page} - 1) * 10
	</select>
	
	<select id="findOneByStdInfoId" parameterType="String" resultType="mGmStdLinkNodeMngInfo">
		SELECT
			STD_INFO_ID,
			STD_INFO_NM,
			APLCN_YMD,
			SAVE_INFO,
			STD_APLCN_TYPE,
			RMRK
		FROM
			M_GM_STD_LINK_NODE_MNG_INFO
		WHERE
			STD_INFO_ID = #{stdInfoId};
	</select>
	
	<delete id="deleteByStdInfoId" parameterType="String">
		DELETE FROM M_GM_STD_LINK_NODE_MNG_INFO
		WHERE STD_INFO_ID = #{stdInfoId};
	</delete>
	
	<update id="updateMGmStdLinkNodeMngInfo" parameterType="mGmStdLinkNodeMngInfo">
		UPDATE M_GM_STD_LINK_NODE_MNG_INFO SET 
			STD_INFO_NM = #{stdInfoNm},
			<if test="aplcnYmd != null and aplcnYmd !=''">
				APLCN_YMD = #{aplcnYmd},
			</if>
			SAVE_INFO = #{saveInfo},
			STD_APLCN_TYPE = #{stdAplcnType},
			RMRK = #{rmrk}
		WHERE STD_INFO_ID = #{stdInfoId}
	</update>
	
	
	<select id="findAllDataYears" resultType="map">
        SELECT
				TO_CHAR(TO_DATE(APLCN_YMD ,'YYYYMMDD'),'YYYY') AS "year"
		FROM
				M_GM_STD_LINK_NODE_MNG_INFO MGSLNMI
		GROUP BY TO_CHAR(TO_DATE(APLCN_YMD ,'YYYYMMDD'),'YYYY')
		ORDER BY TO_CHAR(TO_DATE(APLCN_YMD ,'YYYYMMDD'),'YYYY') DESC
    </select>
</mapper>
